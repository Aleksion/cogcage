# TASK-005 + TASK-006

## Context
The Molt Pit's MatchEngine Durable Object is live. Play.tsx now subscribes to the DO
WebSocket instead of running the client-side engine. The old client-side engine files
are now dead code, and the result screen needs latency/perf stats.

---

## TASK-005: Remove client-side match-runner.ts

### What to delete / clean up
- `web/src/lib/ws2/match-runner.ts` — the old client-side async match loop (no longer called)
- Any imports of `runMatchAsync` that are now dead (Play.tsx already removed its call in TASK-004)
- Check `web/src/lib/ws2/index.ts` — if it re-exports match-runner, remove that export
- Do NOT delete `web/src/lib/ws2/engine.ts`, `types.ts`, `constants.ts` — these are still used
  for type definitions and constants referenced by Play.tsx and the DO

### Verify nothing breaks
```bash
npm --prefix web run build
```
Must pass with zero errors.

---

## TASK-006: Decision latency + perf stats on result screen

### What to build
When a match ends (the DO sends `{ type: "match_complete", result }`) and Play.tsx
shows the result screen, display performance stats for each bot:

**Stats to show (per bot):**
- `ticksPlayed` — total ticks the match ran
- `ticksMissed` — ticks where the bot had no action queued (NO_OP forced)
- `avgDecisionMs` — average time between tick received and action queued (if tracked)
- `actionsQueued` — total actions successfully pushed to queue

The DO's `MatchResult` type (in `engine/src/game/types.ts`) may need extending to include
per-bot stats. Check what's already there. If it only has `winner`, `loser`, `tickCount`,
add:

```typescript
export interface BotStats {
  ticksPlayed: number;
  ticksMissed: number;
  actionsQueued: number;
}

export interface MatchResult {
  winner: string;
  loser: string;
  tickCount: number;
  reason: string;
  botStats?: Record<string, BotStats>;  // botId → stats
}
```

### Where to show it
In `web/src/components/Play.tsx`, the result screen (phase === 'result').
After the winner/loser display, add a "Match Stats" section:

```
┌─────────────────────────────────┐
│  MATCH STATS                    │
│  Bot A: 47/50 ticks connected   │
│  Bot B: 31/50 ticks connected   │
│  3 ticks missed = 3 free hits   │
└─────────────────────────────────┘
```

Keep the visual style consistent with existing result screen (dark bg, cyan accents,
Bangers/Kanit fonts, same card pattern as HP bars).

### Framing
This is a competitive mechanic reveal — "your bot missed 6 ticks" is not an error
message, it's signal that tells players to optimize their system prompt / model / latency.
Copy tone: competitive, not apologetic.

Example copy:
- "3 ticks missed — 3 free turns gifted to your opponent."
- "Perfect connection — 0 ticks missed."

---

## Build check
```bash
npm --prefix web run build
```

## When Done
Update CHANGELOG.md, commit, open PR to main. Then:
```bash
openclaw system event --text "Done: TASK-005 match-runner removed, TASK-006 latency stats on result screen, PR open" --mode now
```
